{"version":3,"sources":["webpack:///webpack/bootstrap e7cb812dcadc0943fe56?7415","webpack:///./classes/shared/PlayerCharacter.js?0011","webpack:///./client/javascript/index.js","webpack:///./classes/client/FireBall.js","webpack:///./classes/GameSettings.js?ee3d","webpack:///./classes/shared/GameObject.js?6e6e","webpack:///./classes/shared/Sprite.js?76e1","webpack:///./classes/MessageTypes.js?78f9","webpack:///./classes/shared/Character.js?b9d7"],"names":["PlayerCharacter","characterName","startX","startY","name","level","strength","health","tx","ty","color","position","Math","round","x","TILE_SCALE","y","tileCanvas","document","querySelector","tileContext","getContext","spriteCanvas","spriteContext","cursorCanvas","cursorContext","MODE_PLAY","MODE_EDIT","client","token","undefined","gameMode","TileTypes","DIRT","GRASS","ROCK","WATER","PIT","BRIDGE","SpriteTypes","CHEST","FIREBALL","PLAYER","TileColorMap","Map","set","SpriteTextureMap","ImageLoader","playerCharacter","tileMap","sprites","startSocketClient","sock","socket","WebSocket","onmessage","event","message","JSON","parse","data","type","Who","sendPackage","who","Authentication","success","LoginSucceeded","LoginFailed","error","Port","console","log","push","setPosition","start","drawCanvas","MoveTo","drawSprites","onclose","something","onerror","toast","Object","assign","startGame","title","t","tToast","content","toastDiv","importNode","tClose","tTitle","tMessage","textContent","addEventListener","e","classList","add","setTimeout","parentElement","removeChild","stopPropagation","appendChild","initCanvas","handleResize","length","width","body","offsetWidth","height","offsetHeight","fillStyle","fillRect","drawBackground","r","row","c","cell","get","clearRect","forEach","sprite","drawSprite","angle","drawCircle","radius","fill","strokeColor","centerX","centerY","beginPath","arc","PI","lineWidth","strokeStyle","stroke","imageSource","imgElement","rotAngle","Image","src","onImageLoad","translate","rotate","drawImage","removeEventListener","keyPressed","keyName","indexOf","code","parseInt","split","send","stringify","KeyPressed","action","keyReleased","KeyReleased","keyMap","keyDown","keyInfo","find","k","keyCode","keyUp","mouseMove","focusedTileCoords","floor","clientX","clientY","clearCursors","drawCursors","mouseClick","fireball","delete","deleteFireball","filter","s","selectedTileCoords","getCanvasCoords","updateCursors","info","cursors","source","cursor","cursorSource","cursorElement","tryMovePlayer","dir","newPosition","isWalkable","tile","tileTypeAtPosition","includes","initEventHandlers","onkeydown","onkeyup","window","onresize","updateSprites","delta","update","levelId","updateLoop","loopTime","performance","now","timestamp","requestAnimationFrame","attributes","Error","FireBall","aim","velocity","atan2","livesUntil","deltaY","sin","deltaX","cos","module","exports","GameSettings","GameObject","Sprite","MessageTypes","Cast","Character","spellId"],"mappings":"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","file":"client/javascript/client.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e7cb812dcadc0943fe56","\nimport Character from './Character';\nimport GameSettings from '../GameSettings';\n\nclass PlayerCharacter extends Character {\n  constructor(characterName = 'BoOoOoOob', startX = 1, startY = 1) {\n    super();\n    \n    this.name = characterName;\n    this.level = 1;\n    this.strength = 1;\n    this.health = 50;\n    \n    this.tx = startX;\n    this.ty = startY;\n    \n    this.color = '#3aadd1'; // TODO: Do we want to keep this property?\n  }\n\n  setPosition(position) {\n    super.setPosition(position);\n    this.tx = Math.round(this.position.x / GameSettings.TILE_SCALE);\n    this.ty = Math.round(this.position.y / GameSettings.TILE_SCALE);\n    if(this.tx < 0) this.tx = 0;\n    if(this.ty < 0) this.ty = 0;\n  }\n};\n\nexport default PlayerCharacter;\n\n\n// WEBPACK FOOTER //\n// ./classes/shared/PlayerCharacter.js","import FireBall from '../../classes/client/FireBall';\nimport PlayerCharacter from '../../classes/shared/PlayerCharacter';\n\n// tile canvas\nconst tileCanvas = document.querySelector('#tileCanvas');\nconst tileContext = tileCanvas.getContext('2d');\n// sprite canvas\nconst spriteCanvas = document.querySelector('#spriteCanvas');\nconst spriteContext = spriteCanvas.getContext('2d');\n// UI canvas / div ---- // TODO???\n// Cursor canvas\nconst cursorCanvas = document.querySelector('#cursorCanvas');\nconst cursorContext = cursorCanvas.getContext('2d');\n\nimport MessageTypes from '../../classes/MessageTypes';\nimport GameSettings from '../../classes/GameSettings';\n\n\n// Modes\nconst MODE_PLAY = 'PLAY';\nconst MODE_EDIT = 'EDIT';\n\n// Application globals\nconst client = {\n  token: undefined,\n};\nconst TILE_SCALE = GameSettings.TILE_SCALE;\nconst gameMode = MODE_PLAY;\n\n// Tile Types\nconst TileTypes = {\n  DIRT: 0,\n  GRASS: 1,\n  ROCK: 2,\n  WATER: 3,\n  PIT: 4,\n  BRIDGE: 5,\n};\nconst SpriteTypes = {\n  CHEST: 0,\n  FIREBALL: 1,\n  PLAYER: 2,\n};\nconst TileColorMap = new Map();\nTileColorMap.set(TileTypes.DIRT, '#5b2607');\nTileColorMap.set(TileTypes.GRASS, 'green');\nTileColorMap.set(TileTypes.ROCK, 'grey');\nTileColorMap.set(TileTypes.WATER, 'blue');\nTileColorMap.set(TileTypes.PIT, 'black');\nTileColorMap.set(TileTypes.BRIDGE, '#7c4b2e');\n\nconst SpriteTextureMap = new Map();\nSpriteTextureMap.set(SpriteTypes.CHEST, './images/ChestClosed.png');\nSpriteTextureMap.set(SpriteTypes.FIREBALL, './images/FireballStatic.png');\nSpriteTextureMap.set(SpriteTypes.PLAYER, './images/PlayerOverhead.png');\n\nconst ImageLoader = new Map();\n\nlet playerCharacter = null;\n\n// level tiles / objects for map the player is currently on.\nlet tileMap = [];\nlet sprites = [];\n\n// Start socket\nfunction startSocketClient() {\n  // TODO: Does this cause conflicts if called more than once?\n  const sock = client.socket || new WebSocket('ws://localhost:8080/');\n  client.socket = sock;\n\n  sock.onmessage = function onmessage(event) {\n    const message = JSON.parse(event.data);\n\n    switch (message.type) {\n      case MessageTypes.Who:\n        sendPackage(MessageTypes.Who, { who: 'James:df8c8023ae' });\n        break;\n      case MessageTypes.Authentication:\n        if (message.success === true) {\n          LoginSucceeded(message);\n        } else {\n          LoginFailed(message.error);\n        }\n        break;\n      case MessageTypes.Port:\n        console.log('PORTED');\n        if (message.success === true) {\n          console.log(message.level);\n          tileMap = message.level.tileMap;\n          sprites.push(...message.level.sprites);\n          \n          playerCharacter.setPosition(message.level.start);\n\n          sprites.push(playerCharacter);\n          // TODO: Can we determine if this is a first load?\n          drawCanvas();\n        }\n        break;\n      case MessageTypes.MoveTo:\n        console.log(\"Attempted to move: \", message);\n        playerCharacter.setPosition(message);\n        drawSprites();\n        break;\n      default:\n        console.log('Message type not recognized: ', event.data);\n        break;\n    }\n  };\n\n  sock.onclose = function onclose(something) {\n    console.log('Something -> ', something);\n  };\n  sock.onerror = function onerror(something) {\n    console.log('Some Error -> ', something);\n  };\n}\n\n// Pipeline message handlers\nfunction LoginSucceeded(message = {}) {\n  if (!message.token) return;\n  client.token = message.token; // Save to global for later use.\n  toast('Welcome', 'Connected to server.');\n\n  playerCharacter = Object.assign(new PlayerCharacter(), JSON.parse(message.playerCharacter));\n  // TODO: Show loading message.\n  startGame();\n}\n\nfunction LoginFailed(error = 'not defined') {\n  /* eslint-disable no-alert */\n  toast('YOU FAILED!!!');\n  toast(\"PS. Who doesn't hate alerts?\");\n  toast('Oh and the error was: ', error);\n}\n\nfunction toast(title = 'Toast', message) {\n  // TODO: Develop/borrow toaster alert\n\n  const t = document.querySelector('#toast__template');\n\n  const tToast = t.content.querySelector('.toast');\n  const toastDiv = document.importNode(tToast, true);\n\n  const tClose = toastDiv.querySelector('.toast__close');\n  const tTitle = toastDiv.querySelector('.toast__title');\n  const tMessage = toastDiv.querySelector('.toast__message');\n\n  tTitle.textContent = title;\n  tMessage.textContent = message;\n  tClose.addEventListener('click', (e) => {\n    // Start CSS animation. Takes 2.5 seconds.\n    toastDiv.classList.add('closing');\n    // Remove after completely faded out. (2.5 seconds)\n    setTimeout(() => { toastDiv.parentElement.removeChild(toastDiv); }, 2500);\n    e.stopPropagation();\n  });\n\n  document.querySelector('#toasts').appendChild(toastDiv);\n}\n\n// Set up canvas: (Note: may need to use this later to reinit when screen size changes.)\nfunction initCanvas() {\n  handleResize();\n  if (tileMap.length > 0) drawCanvas(); // TODO: Put this in a timed loop?\n}\n\nfunction handleResize() {\n  spriteCanvas.width = cursorCanvas.width = tileCanvas.width = document.body.offsetWidth;\n  spriteCanvas.height = cursorCanvas.height = tileCanvas.height = document.body.offsetHeight;\n  drawCanvas();\n}\n\n// Draw canvas\nfunction drawCanvas() {\n  tileContext.fillStyle = 'cyan';\n  // clear bg\n  tileContext.fillRect(0, 0, tileCanvas.width, tileCanvas.height);\n\n  // draw background tiles\n  drawBackground();\n\n  // draw sprites\n  drawSprites();\n\n  // TODO: draw HUD\n}\n\nconst drawBackground = function drawBackground() {\n  // TODO: Rewrite using array functions for looping.\n  for (let r = 0; r < tileMap.length; r += 1) {\n    const row = tileMap[r];\n    for (let c = 0; c < row.length; c += 1) {\n      const cell = row[c];\n      tileContext.fillStyle = TileColorMap.get(cell);\n      tileContext.fillRect(c * TILE_SCALE, r * TILE_SCALE, TILE_SCALE, TILE_SCALE);\n    }\n  }\n};\n\nconst drawSprites = function drawSprites() {\n  // TODO: Check differences. Only erase previous sprites if they moved and redraw???\n\n  // but for now, lets just clear sprites and redraw\n  spriteContext.clearRect(0, 0, spriteCanvas.width, spriteCanvas.height);\n\n  sprites.forEach((sprite) => {\n    const color = sprite.color || TileColorMap.get(sprite.type) || '#FFFFFF';\n\n    if (sprite instanceof FireBall) {\n      drawSprite(sprite.x, sprite.y, SpriteTextureMap.get(SpriteTypes.FIREBALL), sprite.angle);\n    } else if (sprite instanceof PlayerCharacter) {\n      drawSprite(sprite.position.x, sprite.position.y, SpriteTextureMap.get(SpriteTypes.PLAYER), sprite.angle || 0);\n      //drawCircle(sprite.tx, sprite.ty, (TILE_SCALE / 2) - 2, color);\n    } else {\n      drawSprite(sprite.tx * TILE_SCALE, sprite.ty * TILE_SCALE, SpriteTextureMap.get(sprite.type));\n    }\n  });\n};\n\n// Canvas helper functions\nconst drawCircle = function drawCircle(x, y, radius = TILE_SCALE, fill = '#FFFFFF', strokeColor = '#000000') {\n  const centerX = (x * TILE_SCALE) + (TILE_SCALE / 2);\n  const centerY = (y * TILE_SCALE) + (TILE_SCALE / 2);\n\n  tileContext.beginPath();\n  tileContext.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);\n  tileContext.fillStyle = fill;\n  tileContext.fill();\n  tileContext.lineWidth = 1;\n  tileContext.strokeStyle = strokeColor;\n  tileContext.stroke();\n};\n\nconst drawSprite = function drawSprite(x, y, imageSource, angle = null) {\n  // const imgElement = document.querySelector('#image-loader');\n\n  let imgElement = ImageLoader.get(imageSource);\n  let rotAngle = 0;\n  if (angle) {\n    rotAngle = angle; // (angle * Math.PI) / 180;\n  }\n  if (!imgElement) {\n    imgElement = new Image();\n    imgElement.src = imageSource;\n    const onImageLoad = () => {\n      spriteContext.translate(x, y);\n      spriteContext.rotate(rotAngle);\n      spriteContext.drawImage(imgElement, 0, 0);\n      spriteContext.rotate(-rotAngle);\n      spriteContext.translate(-x, -y);\n\n      ImageLoader.set(imageSource, imgElement);\n      imgElement.removeEventListener('load', onImageLoad);\n    };\n    // TODO: handle errors where images are not found.\n    imgElement.addEventListener('load', onImageLoad);\n  } else {\n    spriteContext.translate(x, y);\n    spriteContext.rotate(rotAngle);\n    spriteContext.drawImage(imgElement, 0, 0);\n    spriteContext.rotate(-rotAngle);\n    spriteContext.translate(-x, -y);\n  }\n};\n\nfunction keyPressed(keyName) {\n  if (keyName.indexOf('UNMAPPED') === 0) {\n    const code = parseInt(keyName.split(':')[1], 10);\n    console.log(`Unmapped key pressed: ${code}`);\n  } else {\n    client.socket.send(JSON.stringify({ type: MessageTypes.KeyPressed, action: keyName }));\n  }\n}\nfunction keyReleased(keyName) {\n  if (keyName.indexOf('UNMAPPED') === 0) {\n    const code = parseInt(keyName.split(':')[1], 10);\n    console.log(`Unmapped key released: ${code}`);\n  } else {\n    client.socket.send(JSON.stringify({ type: MessageTypes.KeyReleased, action: keyName }));\n  }\n}\n\nconst keyMap = [\n  { code: 65, action: 'LEFT ' }, // a\n  { code: 65, action: 'LEFT' },\n  { code: 37, action: 'LEFT' }, // left arrow\n  { code: 87, action: 'UP' }, // w\n  { code: 38, action: 'UP' }, // up arrow\n  { code: 68, action: 'RIGHT' }, // d\n  { code: 39, action: 'RIGHT' }, // right arrow\n  { code: 83, action: 'DOWN' }, // s\n  { code: 40, action: 'DOWN' }, // down arrow\n  { code: 16, action: 'SHIFT' },\n];\n\n// Low Level Event Handlers\nfunction keyDown(e) {\n  const keyInfo = keyMap.find(k => k.code === e.keyCode);\n  if (keyInfo) {\n    keyPressed(keyInfo.action);\n  } else {\n    keyPressed(`UNMAPPED:${e.keyCode}`);\n  }\n}\nfunction keyUp(e) {\n  const keyInfo = keyMap.find(k => k.code === e.keyCode);\n  if (keyInfo) {\n    keyReleased(keyInfo.action);\n  } else {\n    keyReleased(`UNMAPPED:${e.keyCode}`);\n  }\n}\nfunction mouseMove(e) {\n  cursorCanvas.focusedTileCoords = {\n    tx: Math.floor(e.clientX / TILE_SCALE),\n    ty: Math.floor(e.clientY / TILE_SCALE)\n  };\n\n  clearCursors();\n  drawCursors();\n}\nfunction mouseClick(e) {\n  // fireball is flavor like image and particle systems\n  // fireball should inherit from projectile // projectile manages speed and angle and updates position\n  // projectile should inherit from sprite // sprite is an object with a visual representation that shows up above the tiled map\n  // sprite should inherit from gameobject // Gameobject is something that belongs to a map. It has a position, but does not necessarily have a representation.\n  const fireball = new FireBall(\n    { x: playerCharacter.tx * TILE_SCALE, y: playerCharacter.ty * TILE_SCALE }, // start\n    { x: e.clientX, y: e.clientY }, // aim at\n    32 * 18 // speed\n  );\n  fireball.delete = function deleteFireball() {\n    sprites = sprites.filter(s => s !== this);\n  };\n  sprites.push(fireball);\n  drawCanvas();\n  cursorCanvas.selectedTileCoords = getCanvasCoords({ x: e.clientX, y: e.clientY });\n  updateCursors();\n}\n\nfunction getCanvasCoords(info) {\n  return {\n    tx: Math.floor(info.x / TILE_SCALE) || 0,\n    ty: Math.floor(info.y / TILE_SCALE) || 0,\n  };\n}\n\nfunction clearCursors() {\n  cursorContext.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);\n}\n\nfunction updateCursors() {\n  clearCursors();\n  drawCursors();\n}\n\nfunction drawCursors() {\n  const cursors = [\n    {\n      type: 'SELECTED',\n      source: './images/SelectionCursorSelected.png',\n      tx: (cursorCanvas.selectedTileCoords && cursorCanvas.selectedTileCoords.tx) || 0,\n      ty: (cursorCanvas.selectedTileCoords && cursorCanvas.selectedTileCoords.ty) || 0\n    },\n  ];\n  if (gameMode === MODE_EDIT) {\n    cursors.push({\n      type: 'FOCUSED',\n      source: './images/SelectionCursorFocused.png',\n      tx: (cursorCanvas.focusedTileCoords && cursorCanvas.focusedTileCoords.tx) || 0,\n      ty: (cursorCanvas.focusedTileCoords && cursorCanvas.focusedTileCoords.ty) || 0\n    });\n  }\n  cursors.forEach((cursor) => {\n    if (cursor.tx === null || cursor.ty === null) return;\n    const cursorSource = cursor.source;\n    let cursorElement = ImageLoader.get(cursorSource);\n    if (!cursorElement) {\n      cursorElement = new Image();\n      cursorElement.src = cursorSource;\n      const onImageLoad = () => {\n        cursorContext.drawImage(cursorElement, cursor.tx * TILE_SCALE, cursor.ty * TILE_SCALE);\n        ImageLoader.set(cursorSource, cursorElement);\n        cursorElement.removeEventListener('load', onImageLoad);\n      };\n      // TODO: handle errors where images are not found.\n      cursorElement.addEventListener('load', onImageLoad);\n    } else {\n      cursorContext.drawImage(cursorElement, cursor.tx * TILE_SCALE, cursor.ty * TILE_SCALE);\n    }\n  });\n}\n\n// Event Handler Abstractions\nconst tryMovePlayer = function tryMovePlayer(dir) {\n  // TODO: ensure we are allowed to move in the direction we want to before attempting to move.\n  const newPosition = {\n    tx: playerCharacter.tx,\n    ty: playerCharacter.ty,\n  };\n  switch (dir) {\n    case 'LEFT':\n      newPosition.tx = playerCharacter.tx - 1;\n      break;\n    case 'RIGHT':\n      newPosition.tx = playerCharacter.tx + 1;\n      break;\n    case 'UP':\n      newPosition.ty = playerCharacter.ty - 1;\n      break;\n    case 'DOWN':\n      newPosition.ty = playerCharacter.ty + 1;\n      break;\n    default:\n      console.log('Invalid Direction');\n      break;\n  }\n  if (isWalkable(newPosition)) {\n    playerCharacter.tx = newPosition.tx;\n    playerCharacter.ty = newPosition.ty;\n  } else {\n    // TODO: play \"can't walk\" sound.\n  }\n\n  drawCanvas();\n};\nconst isWalkable = function isWalkable(tile) {\n  // tile should have at minimum: { x , y }\n  if (tile.ty < 0 || tile.tx < 0) return false;\n\n  const tileTypeAtPosition = tileMap[tile.ty][tile.tx];\n\n  if ([TileTypes.DIRT, TileTypes.GRASS, TileTypes.BRIDGE].includes(tileTypeAtPosition)) {\n    if (!sprites.filter(s => s.tx === tile.tx && s.ty === tile.ty).length > 0) {\n      return true;\n    }\n  }\n  return false;\n};\n\nfunction initEventHandlers() {\n  document.onkeydown = keyDown;\n  document.onkeyup = keyUp;\n  document.addEventListener('mousemove', mouseMove);\n  document.addEventListener('click', mouseClick);\n  window.onresize = handleResize;\n}\n\n// server side\nfunction updateSprites(delta) {\n  sprites.forEach((sprite) => {\n    if (sprite.update) {\n      sprite.update(delta);\n    }\n  });\n}\n\n// Initiate game\nfunction startGame() {\n  initCanvas();\n  initEventHandlers();\n  sendPackage(MessageTypes.Port, { levelId: 1 });\n  updateLoop();\n}\n\nlet loopTime = performance.now();\nfunction updateLoop(timestamp = performance.now()) {\n  const delta = (timestamp - loopTime) / 1000;\n  loopTime = timestamp;\n  updateSprites(delta);\n  drawCanvas();\n  window.requestAnimationFrame(updateLoop);\n}\n\nconst sendPackage = function sendPackage(type = null, attributes = {}) {\n  if (type === null) throw new Error('Package type must be specified.');\n\n  client.socket.send(JSON.stringify(Object.assign({ type }, attributes)));\n};\n\nstartSocketClient(); // TODO: Need to monitor and reconnect\n\n\n\n// WEBPACK FOOTER //\n// ./client/javascript/index.js","\nconst FireBall = function FireBall(start = {}, aim = {}, velocity = 32) {\n  // https://gist.github.com/conorbuck/2606166\n  this.angle = Math.atan2(aim.y - start.y, aim.x - start.x); // if you want degrees, do this too!!! * 180 / Math.PI;\n\n  this.x = start.x - 16;\n  this.y = start.y - 16;\n  this.velocity = velocity;\n\n  this.livesUntil = performance.now() + (1.5 * 1000); // 3 seconds.\n\n  this.setPosition = (position) => {\n    this.x = position.x;\n    this.y = position.y;\n  };\n\n  this.update = (delta) => {\n    if (performance.now() > this.livesUntil) {\n      this.delete();\n    }\n    // SOH, CAH, TOA\n    const deltaY = Math.sin(this.angle) * this.velocity * delta;\n    const deltaX = Math.cos(this.angle) * this.velocity * delta;\n    this.x += deltaX;\n    this.y += deltaY;\n  };\n};\n\nmodule.exports = FireBall;\n\n\n// WEBPACK FOOTER //\n// ./classes/client/FireBall.js","\nconst GameSettings = {\n  TILE_SCALE: 32\n}\n\nexport default GameSettings;\n\n\n// WEBPACK FOOTER //\n// ./classes/GameSettings.js","\nclass GameObject {\n  constructor() {\n    this.position = {\n      x: 0,\n      y: 0\n    }\n  }\n}\n\nexport default GameObject;\n\n\n// WEBPACK FOOTER //\n// ./classes/shared/GameObject.js","import GameObject from './GameObject'\n\nclass Sprite extends GameObject {\n  \n  setPosition(position) {\n    this.position.x = position.x;\n    this.position.y = position.y;\n    if(this.position.x < 0) this.position.x = 0;\n    if(this.position.y < 0) this.position.y = 0;\n  }\n\n}\n\nexport default Sprite;\n\n\n// WEBPACK FOOTER //\n// ./classes/shared/Sprite.js","const MessageTypes = {\n  Who: 'WHO',\n  Authentication: 'AUTHENTICATION',\n  Port: 'PORT',\n  KeyPressed: 'KEY_PRESSED',\n  KeyReleased: 'KEY_RELEASED',\n  MoveTo: 'MOVE_TO',\n  Cast: 'CAST'\n};\nexport default MessageTypes;\n\n\n// WEBPACK FOOTER //\n// ./classes/MessageTypes.js","import Sprite from './Sprite';\n\nclass Character extends Sprite {\n  canCast(spellId) {\n    // TODO: Check if the character has the spell in their spellbook and if it's not on cooldown.\n    return true;\n  }\n}\n\nexport default Character;\n\n\n// WEBPACK FOOTER //\n// ./classes/shared/Character.js"],"sourceRoot":""}